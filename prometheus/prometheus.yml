# ============================================================================
# PROMETHEUS CONFIGURATION
# Archivo: ./prometheus/prometheus.yml
# ============================================================================

global:
  scrape_interval: 15s      # Cada cuánto scrapea métricas
  evaluation_interval: 15s  # Cada cuánto evalúa reglas
  external_labels:
    cluster: 'lab-observability'
    environment: 'development'

# Configuración para recibir métricas vía Remote Write (desde OTel)
# Ya está habilitado en el docker-compose con --web.enable-remote-write-receiver

# ============================================================================
# SCRAPE CONFIGS - Targets de donde Prometheus recolecta métricas
# ============================================================================
scrape_configs:
  # --------------------------------------------------------------------------
  # Métricas del propio Prometheus
  # --------------------------------------------------------------------------
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # --------------------------------------------------------------------------
  # Métricas del OTel Collector
  # --------------------------------------------------------------------------
  - job_name: 'otel-collector'
    static_configs:
      - targets: ['otel-collector:8888']  # Métricas internas del collector
        labels:
          service: 'otel-collector'
      - targets: ['otel-collector:8889']  # Métricas exportadas por el collector
        labels:
          service: 'otel-exported-metrics'

  # --------------------------------------------------------------------------
  # Ejemplo: Scraping de una aplicación externa
  # --------------------------------------------------------------------------
  # Descomenta y modifica según tus necesidades
  #
  # - job_name: 'mi-aplicacion'
  #   static_configs:
  #     - targets: ['<IP-APP>:<PUERTO>']
  #       labels:
  #         service: 'mi-app'
  #         environment: 'lab'

  # --------------------------------------------------------------------------
  # Ejemplo: Service Discovery en Docker
  # --------------------------------------------------------------------------
  # - job_name: 'docker-containers'
  #   docker_sd_configs:
  #     - host: unix:///var/run/docker.sock
  #   relabel_configs:
  #     - source_labels: [__meta_docker_container_name]
  #       target_label: container

# ============================================================================
# REMOTE WRITE - Para enviar métricas a otros sistemas (opcional)
# ============================================================================
# remote_write:
#   - url: "http://otro-prometheus:9090/api/v1/write"

# ============================================================================
# ALERTING - Configuración de alertas (opcional)
# ============================================================================
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: ['alertmanager:9093']

# ============================================================================
# NOTES PARA OTEL:
# ============================================================================
# Cuando uses OTel Collector, las métricas llegarán automáticamente a 
# Prometheus vía Remote Write al endpoint:
# http://prometheus:9090/api/v1/write
#
# No necesitas configurar scrape_configs adicionales para apps que usen OTel
# ============================================================================